/*! main.min.js 2015-09-01 */
function run(){showSettings(),loadPagesIntoLocalStorage(),turnOnHotkeys(),hotkeysOnOff()}function checkPage(){"am_farm"!=window.game_data.screen?loadLA():run()}function loadLA(){fadeToBlack(),openLoader();var a=link[0]+window.game_data.village.id+link[1];$.getScript("https://"+window.location.host+"/js/game/Accountmanager.js",function(){$.ajax({type:"GET",url:a,dataType:"html",error:function(a,b){alert("Error: "+b),$("#fader").remove(),$("#loaders").remove()},success:function(a){var b=$(a),c=a.split("<title>")[1].split("</title>")[0];window.game_data=$.parseJSON(a.split("var game_data = ")[1].split("};")[0]+"}"),$("#header_info").html($("#header_info",b).html()),$("#topContainer").html($("#topContainer",b).html()),$("#contentContainer").html($("#contentContainer",b).html()),$("head").find("title").html(c),$("#fader").remove(),$("#loaders").remove(),run()}})})}function loadPagesIntoLocalStorage(){reports=TAFFY();var a=parseInt($(".paged-nav-item:last").html().replace(/\D/g,"")),b=scriptSettings.start_page-1,c=scriptSettings.end_page;"max"==c&&(c=a),removeFirstPage();for(var d=b;c>d;d++)$.ajax({type:"GET",url:link[0]+window.game_data.village.id+"&order=distance&dir=asc&Farm_page="+d+"&screen=am_farm",async:!0,dataType:"html",success:function(a){console.log("page: "+d),desktopTableExtract(a)}})}function desktopTableExtract(a){for(var b=$("#plunder_list > tbody > tr",a),c=1;c<b.length;c++){for(var d=$(b[c]).find("td"),e=0;e<d.length;e++){var f=$(d[e]);switch(e){case 1:var g=f.find("img").attr("src").split("/");g=g[g.length-1].split(".png")[0];break;case 2:var h=f.find("img");h.length>0?(h=h.attr("src").split("/"),h=parseInt(h[h.length-1].split(".png")[0])):h=null;break;case 3:var i=$.trim(f.find("a").html()),j=getUrlParameter(f.find("a").attr("href"),"view"),k=f.find("img").prop("title");k=parseInt(void 0!=k?k.replace(/\D/g,""):0);var l=parseInt(f.find("a").html().split("K")[1]);break;case 4:var m=getVillageAttackedTime(f),n=showTimeSincePlunder(m);break;case 5:var o=f.children("span");if(3==o.length)var p=parseInt($($(o.get(0)).children("span").get(1)).html().replace(/\D/g,"")),q=parseInt($($(o.get(1)).children("span").get(1)).html().replace(/\D/g,"")),r=parseInt($($(o.get(2)).children("span").get(1)).html().replace(/\D/g,"")),s=p+q+r;else var p=-1,q=-1,r=-1;break;case 6:var t=parseInt(f.html());t=isNaN(t)?-1:t;break;case 7:var u=parseFloat(f.html());break;case 8:var v=f.html(),w=f.find("a").attr("onclick");w=$.trim(w.slice(w.indexOf("(")+1,w.indexOf(")")).split(",")[1]);var x=villageAttacks({villageID:parseInt(w)}).first();x=new Date(x.sentTime),x=x.getFullYear()+","+(x.getMonth()+1)+","+(x.getDay()+1)+","+x.getHours()+","+x.getMinutes()+","+x.getSeconds();var y=showTimeSincePlunder(x);break;case 9:var z=f.html();break;case 10:var A=f.html()}}var B={main:-1,barracks:-1,stable:-1,garage:-1,church:-1,snob:-1,smith:-1,place:-1,statue:-1,market:-1,wood:-1,stone:-1,iron:-1,farm:-1,storage:-1,hide:-1,wall:-1},C=0;getBuildings&&(reportBuildings({reportID:j}).count()>0?(B=reportBuildings({reportID:j}).first().buildings,C=getBuildingPoints(reportBuildings({reportID:j}).first().buildings)):getBuildingLevels(j,w)),reports.insert({reportID:j,village:i,villageToAttack:w,dot:g,loot:h,attacks:k,plunderTime:m,sentTime:x,timeSincePlunder:n,timeSinceSent:y,continent:l,wood:p,clay:q,iron:r,resources:s,buildings:B,distance:u,wall:t,points:C,aButton:v,bButton:z,cButton:A}),console.log(reports({reportID:j}).first())}}function createNewTable(a,b){return $("#plunder_list tr").slice(1).remove(),reports().order(a+" "+b).each(function(a,b){checkRowToHide(a);var c="<td><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/dots/"+a.dot+".png?bb7c6'></td>",d=null!=a.loot?"<td><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/max_loot/"+a.loot+".png?c2b58'></td>":"<td></td>",e="<td><a href='/game.php?village="+window.game_data.village.id+"&mode=all&view="+a.reportID+"&screen=report'> "+a.village+"</a></td>",f="<td>"+a.attacks+"</td>",g="<td>"+a.timeSincePlunder+"</td>",h="<td>"+a.timeSinceSent+"</td>",i="<td>"+(-1==a.wood?"?":a.wood.toLocaleString("de-DE"))+"</td>",j="<td>"+(-1==a.clay?"?":a.clay.toLocaleString("de-DE"))+"</td>",k="<td>"+(-1==a.iron?"?":a.iron.toLocaleString("de-DE"))+"</td>",l="";if(getBuildings){var m="<td>"+(a.buildings.main>=0?a.buildings.main:"?")+"</td>",n="<td>"+(a.buildings.barracks>=0?a.buildings.barracks:"?")+"</td>",o="<td>"+(a.buildings.stable>=0?a.buildings.stable:"?")+"</td>",p="<td>"+(a.buildings.garage>=0?a.buildings.garage:"?")+"</td>",q="<td>"+(a.buildings.snob>=0?a.buildings.snob:"?")+"</td>",r="<td>"+(a.buildings.smith>=0?a.buildings.smith:"?")+"</td>",s="<td>"+(a.buildings.statue>=0?a.buildings.statue:"?")+"</td>",t="<td>"+(a.buildings.market>=0?a.buildings.market:"?")+"</td>",u="<td>"+(a.buildings.wood>=0?a.buildings.wood:"?")+"</td>",v="<td>"+(a.buildings.stone>=0?a.buildings.stone:"?")+"</td>",w="<td>"+(a.buildings.iron>=0?a.buildings.iron:"?")+"</td>",x="<td>"+(a.buildings.farm>=0?a.buildings.farm:"?")+"</td>",y="<td>"+(a.buildings.storage>=0?a.buildings.storage:"?")+"</td>",z="<td>"+(a.buildings.hide>=0?a.buildings.hide:"?")+"</td>";l="<td>"+(a.buildings.main>=0?a.points:"?")+"</td>";var A=m+n+o+p+q+r+s+t+u+v+w+x+y+z}var B="<td>"+(-1==a.wall?"?":a.wall)+"</td>",C="<td>"+a.distance+"</td>",D="<td>"+a.aButton.replace("Accountmanager.farm.sendUnits","customSendUnits")+"</td>",E="<td>"+a.bButton.replace("Accountmanager.farm.sendUnits","customSendUnits")+"</td>",F="<td>"+a.cButton.replace("Accountmanager.farm.sendUnitsFromReport","customSendUnitsFromReport")+"</td>",G="<td><a href='#' onclick='' class='farm_icon' id='mp_att' title='Send troops' href='/game.php?village=21289&amp;target=21007&amp;screen=place' style='background-position: 408px 0px;'></a></td>";$("#plunder_list").append("<tr>"+c+d+e+f+g+h+i+j+k+A+B+l+C+D+E+F+G+"</tr>")}),$("#plunder_list tr:even td").css("background","#FFF5DA"),Accountmanager.initTooltips(),!1}function getBuildingLevels(a,b){$.ajax({type:"GET",url:"/game.php?village="+window.game_data.village.id+"&mode=all&view="+a+"&screen=report",async:!0,cache:!1,dataType:"html",success:function(c){var d={main:0,barracks:0,stable:0,garage:0,church:0,snob:0,smith:0,place:0,statue:0,market:0,wood:0,stone:0,iron:0,farm:0,storage:0,hide:0,wall:0};$("#attack_spy_buildings_left tr, #attack_spy_buildings_right tr",c).slice(1).each(function(a){var b=$(this).find("td:eq(0) img").attr("src")+"";return"undefined"==b?!0:(b=b.split("/"),b=b[b.length-1].split(".png")[0],void(d[b]=parseInt($.trim($(this).find("td:eq(1)").html()))))}),reportBuildings({village:b}).count()>0&&reportBuildings({village:b}).remove(),reportBuildings.insert({reportID:a,villageID:b,buildings:d}),reports({villageToAttack:b}).update("buildings",d)}})}function getBuildingPoints(a){var b=0,c={main:[0,10,12,14,17,21,25,30,36,43,52,62,74,89,107,128,154,185,222,266,319,383,460,552,662,795,954,1145,1374,1648,1978],barracks:[0,16,19,23,28,33,40,48,57,69,83,99,119,143,171,205,247,296,355,426,511,613,736,883,1060,1272],stable:[0,20,24,29,35,41,50,60,72,86,103,124,149,178,214,257,308,370,444,532,639],garage:[0,24,29,35,41,50,60,72,86,103,124,149,178,214,257,308],church:[0,10,12,14],snob:[0,512,614,737],smith:[0,19,23,27,33,39,47,57,68,82,98,118,141,169,203,244,293,351,422,506,607],place:[0,0],statue:[0,24],market:[0,10,12,14,17,21,25,30,36,43,52,62,74,89,107,128,154,185,222,266,319,383,460,552,662,795],wood:[0,6,7,9,10,12,15,18,21,26,31,37,45,53,64,77,92,111,133,160,192,230,276,331,397,477,572,687,824,989,1187],stone:[0,6,7,9,10,12,15,18,21,26,31,37,45,53,64,77,92,111,133,160,192,230,276,331,397,477,572,687,824,989,1187],iron:[0,6,7,9,10,12,15,18,21,26,31,37,45,53,64,77,92,111,133,160,192,230,276,331,397,477,572,687,824,989,1187],farm:[0,5,6,7,9,10,12,15,18,21,26,31,37,45,53,64,77,92,111,133,160,192,230,276,331,397,477,572,687,824,989],storage:[0,6,7,9,10,12,15,18,21,26,31,37,45,53,64,77,92,111,133,160,192,230,276,331,397,477,572,687,824,989,1187],hide:[0,5,6,7,9,10,12,15,18,21,26],wall:[0,8,10,12,14,17,20,24,29,34,41,50,59,71,86,103,123,148,177,213,256]};return $.each(a,function(a,d){b+=parseInt(c[a][parseInt(d)])}),b}function sortByColumn(a,b){var c=$(b).attr("class");return $(b).attr("class","asec"==c?"desc":"asec"),createNewTable(a,c),!1}function customSendUnits(a,b,c){a=$(a),a.closest("tr").hide();var d={target:b,template_id:c,source:game_data.village.id};return $.post(Accountmanager.send_units_link,d,function(c){if(c.error)UI.ErrorMessage(c.error),a.closest("tr").show();else{var d=reports({villageToAttack:b+""}).first();reports({villageToAttack:b+""}).update("attacks",d.attacks+1),villageAttacks({villageID:b}).count()>0&&villageAttacks({villageID:b}).remove(),villageAttacks.insert({villageID:b,sentTime:getCurrentGameTime()}),Accountmanager.farm.updateOwnUnitsAvailable(c.current_units)}lastAjaxCall="sendUnits"},"json"),!1}function customSendUnitsFromReport(a,b,c,d){if($link=$(a),$(a).closest("tr").hide(),$link.hasClass("farm_icon_disabled"))return!1;var e={report_id:c};return TribalWars.post(Accountmanager.send_units_link_from_report,null,e,function(a){if("string"==typeof a.success){var c=reports({villageToAttack:b+""}).first();reports({villageToAttack:b+""}).update("attacks",c.attacks+1),villageAttacks({villageID:b}).count()>0&&villageAttacks({villageID:b}).remove(),villageAttacks.insert({villageID:b,sentTime:getCurrentGameTime()}),Accountmanager.farm.updateOwnUnitsAvailable(a.current_units)}$(".farm_village_"+b).addClass("farm_icon_disabled"),Accountmanager.farm.hide_attacked&&Accountmanager.farm.updateNonAttacked(b),lastAjaxCall="sendUnits"}),!1}function getVillageAttackedTime(a){for(var b,c,a,d=a.html(),e=d.split(" "),f=0;f<e.length;f++)a=$.trim(e[f]),a.indexOf(".")>-1?b=a:"today"==a?b="today":"yesterday"==a&&(b="yesterday"),a.indexOf(":")>-1&&(c=a);if("today"==b||"yesterday"==b){var g=currentGameTime.getDate();"yesterday"==b&&g--;var h=currentGameTime.getMonth()+1,i=currentGameTime.getFullYear(),d=c.split(":"),j=d[0],k=d[1],l=d[2];return i+","+("0"+h).slice(-2)+","+("0"+g).slice(-2)+","+("0"+j).slice(-2)+","+("0"+k).slice(-2)+","+("0"+l).slice(-2)}var m=b.split("."),g=m[0],h=m[1];if(h>currentGameTime.getMonth()+1)var i=currentGameTime.getFullYear()-1;else var i=currentGameTime.getFullYear();var d=c.split(":"),j=d[0],k=d[1],l=d[2];return i+","+("0"+h).slice(-2)+","+("0"+g).slice(-2)+","+("0"+j).slice(-2)+","+("0"+k).slice(-2)+","+("0"+l).slice(-2)}function showTimeSincePlunder(a){if(a=a.split(","),isNaN(a[1]))return"?";a=new Date(a[0],a[1]-1,a[2],a[3],a[4],a[5],0);var b=(currentGameTime.getTime()-a.getTime())/1e3;return secondsToTime(b)}function secondsToTime(a){a=Math.round(a);var b=Math.floor(a/3600),c=a%3600,d=Math.floor(c/60),e=c%60,f=Math.ceil(e),g={d:("00"+Math.floor(b/24)).slice(-3),h:("0"+b%24).slice(-2),m:("0"+d).slice(-2),s:("0"+f).slice(-2)};return g.d+":"+g.h+":"+g.m+":"+g.s}function getCurrentGameTime(){var a=$("#serverTime").html().split(":"),b=$("#serverDate").html().split("/");return new Date(b[2],b[1]-1,b[0],a[0],a[1],a[2],0)}function removeFirstPage(){$("#am_widget_Farm h4").remove(),$(".body").remove(),$("#am_widget_Farm").hide()}function fadeToBlack(){var a=document.createElement("div");a.id="fader",a.style.position="fixed",a.style.height="100%",a.style.width="100%",a.style.backgroundColor="black",a.style.top="0px",a.style.left="0px",a.style.opacity="0.6",a.style.zIndex="12000",document.body.appendChild(a)}function openLoader(){var a=document.createElement("div");a.id="loaders",a.style.position="fixed",a.style.width="24px",a.style.height="24px",a.style.top="50%",a.style.left="50%",$(a).css("margin-left","-12px"),$(a).css("margin-top","-12px"),a.style.zIndex=13e3,$(a).append($("<img src='graphic/throbber.gif' height='24' width='24'></img>")),$("#contentContainer").append($(a))}function showSettings(){$("head").append("<link type='text/css' rel='stylesheet' href='"+scriptURL+"css/style.css' />"),$("#contentContainer h3").eq(0).after($("<div class='vis'id='settingsDiv'><h4>LA Enhancer "+version+" - <a href='https://forum.tribalwars.net/showthread.php?266604-ntoombs19-s-FA-Filter'target='_blank'>Instructions</a><span style='font-size:10px;float:right;font-weight:normal;font-style:normal'>Created by <a href='https://forum.tribalwars.net/member.php?22739-ntoombs19'target='_blank'>ntoombs19</a>&nbsp;<div class='vis'style='float:right;text-align:center;line-height:100%;width:12px;height:12px;margin:0px 0px 0px 0px;position:relative;background-color:tan;opacity:.7'><a href='#'num='2'onclick='uglyHider($(this));return false;'>-</a></div></span></h4><table class='settingsTable'><tbody id='settingsBody'><tr><th colspan='1'>General Settings</th><th colspan='4'>Filters</th></tr><tr><td class='col1'style='min-width:200px'><span>Load pages</span>&nbsp;<input type='text'value=''size='1'id='start_page'>&nbsp;<span>to</span>&nbsp;<input type='text'value=''size='1'id='end_page'></td><td colspan='3'><span style='font-weight:bold'>Enable</span>&nbsp;<img src='graphic/questionmark.png'width='13'height='13'id='enable_help'></td><td rowspan='4'valign='top'><form><input type='checkbox'id='blue'><label for='blue'><img src='graphic/dots/blue.png'> Scout attack</label><br><input type='checkbox'id='green'><label for='green'><img src='graphic/dots/green.png'> No losses</label><br><input type='checkbox'id='yellow'><label for='yellow'><img src='graphic/dots/yellow.png'> Some losses</label><br><input type='checkbox'id='red_yellow'><label for='red_yellow'><img src='graphic/dots/red_yellow.png'> Lost, but damaged building(s)</label><br><input type='checkbox'id='red_blue'><label for='red_blue'><img src='graphic/dots/red_blue.png'> Lost, but scouted</label><br><input type='checkbox'id='red'><label for='red'><img src='graphic/dots/red.png'> All units lost</label></form></td></tr><tr><td><label for='sort_first_by'>Sort 1st by:</label>&nbsp;<select id='sort_first_by'><option value='distance-asc'>Distance (Near>Far)</option><option value='distance-desc'>Distance (Far>Near)</option><option value='date-asc'>Time (New>Old)</option><option value='date-desc'>Time (Old>New)</option></select></td><td style='width:26px'><input type='checkbox'id='enable_loot'></td><td style='width:110px'><label for='enable_loot'>Hide loot</label></td><td><input type='radio'name='loot'id='full'><label for='full'><img src='graphic/max_loot/1.png'></label>&nbsp;<input type='radio'name='loot'id='partial'><label for='partial'><img src='graphic/max_loot/0.png'></label>&nbsp;<input type='radio'name='loot'id='none'><label for='none'>None</label></td></tr><tr><td><label for='sort_second_by'>Sort 2nd by:</label>&nbsp;<select id='sort_second_by'><option value='attacks-asec'>Attacks (Few>Many)</option><option value='attacks-desc'>Attacks (Many>Few)</option><option value='sent-asec'>Sent (New>Old)</option><option value='sent-desc'>Sent (Old>New)</option><option value='landed-asec'>Landed (New>Old)</option><option value='landed-desc'>Landed (Old>New)</option><option value='wood-asec'>Wood (Many>Few)</option><option value='wood-desc'>Wood (Few>Many)</option><option value='clay-asec'>Clay (Many>Few)</option><option value='clay-desc'>Clay (Few>Many)</option><option value='iron-asec'>Iron (Many>Few)</option><option value='iron-desc'>Iron (Few>Many)</option><option value='resources-asec'>All Res (Many>Few)</option><option value='resources-desc'>All Res (Few>Many)</option><option value='wall-asec'>Wall (High>Low)</option><option value='wall-desc'>Wall (Low>High)</option><option value='distance-asec'>Distance (Far>Near)</option><option value='distance-desc'>Distance (Near>Far)</option></select></td><td><input type='checkbox'id='enable_attacks'></td><td><label for='enable_attacks'>Hide attacks</label></td><td><select id='attack_operator'><option value='greater_than'>Greater than</option><option value='less_than'>Less than</option><option value='equal_to'>Equal to</option></select>&nbsp;<input type='text'id='attack_value'size='1'value=''></td></tr><tr><td rowspan='1'><input type='checkbox' id='apply_auto'>Apply profile automatically<label></label></td><td><input type='checkbox'id='enable_walls'></td><td><label for='enable_walls'>Hide wall lvls</label></td><td><select id='wall_operator'><option value='greater_than'>Greater than</option><option value='less_than'>Less than</option><option value='equal_to'>Equal to</option></select>&nbsp;<input type='text'id='wall_value'size='1'value=''></td></tr><tr><td><input type='checkbox' id='show_buildings'><label>Show buildings</label></td><td><input type='checkbox'id='enable_distances'></td><td><label for='enable_distances'>Hide distances</label></td><td colspan='2'><select id='distance_operator'><option value='greater_than'>Greater than</option><option value='less_than'>Less than</option><option value='equal_to'>Equal to</option></select>&nbsp;<input type='text'id='distance_value'size='1'value=''></td></tr><tr><td><span style='font-weight:bold;'>Go to next village when...</span></td><td><input type='checkbox' id='enable_continents' /><td colspan='3'><select id='continent_display'><option value='hide'>Hide</option><option value='show'>Show</option></select>&nbsp;<label for='continent_value'>continents</label>&nbsp;<input type='text'size='1'id='continent_value'value=''>&nbsp;<img src='graphic/questionmark.png'height='13'id='continent_help'></td></tr><tr><td><input type='checkbox'id='next_village_no_farms'><label for='next_village_no_farms'>All rows are hidden</label></td><td><input type='checkbox'id='enable_resources'></td><td colspan='3'><label for='enable_resources'>Hide resources</label>&nbsp;<select id='resource_operator'><option value='greater_than'>Greater than</option><option value='less_than'>Less than</option><option value='equal_to'>Equal to</option></select>&nbsp;<input type='text'id='resources_value'size='9'value=''></td></tr><tr><td><input type='checkbox' id='next_village_units' /><label for='next_village_units'>Not enough units available</label></td><td><input type='checkbox'id='enable_attack_time'></td><td colspan='3'><select id='attack_time_display'><option value='hide'>Hide</option><option value='show'>Show</option></select>&nbsp;villages attacked in the last&nbsp;<input type='text'id='attack_time_value'size='9'value=''><span></span></td></tr><tr><td><input type='text' size='1' id='scouts_left' /><label for='scouts_left'>scouts remaining</label></td><td><input type='checkbox' id='enable_sent_time' /></td><td colspan='3'><select id='sent_time_display'><option value='hide'>Hide</option><option value='show'>Show</option></select>&nbsp;villages sent to in the last&nbsp;<input type='text' size='9' id='sent_time_value' /></td></tr><tr><td><input type='text' size='1' id='farming_troops_left' /><label for='farming_troops_left'>farming troops available</label></td><td colspan='4'><div style='float:left;'><input type='submit'value='Apply'onclick='applyFilter()'>&nbsp;<input type='submit'value='Reset'onclick='resetTable()'></div><div style='float:right;'><label for='settingsProfile'>Profile:</label>&nbsp;<select id='settingsProfile'onchange='loadProfile($(\"#settingsProfile\").val())'></select>&nbsp;<input type='submit'value='New'onclick='newProfileDialog()'>&nbsp;<input type='submit'value='Set default'onclick='setDefaultProfile()'>&nbsp;<input type='submit'value='Delete'onclick='deleteProfile()'>&nbsp;<input type='submit'value='Export'onclick='exportProfile()'>&nbsp;<input type='submit'value='Import'onclick='importProfile()'></div></td></tr><th>Hot Keys</th><th colspan='4'>Master Button Settings</th></tr><tr><td rowspan='4'><table><tr class='hotkey_values'><td><a href='#'onclick='return setKeyEditMode(\"A\")'id='button_a'class='farm_icon farm_icon_a'></a></td><td><a href='#'onclick='return setKeyEditMode(\"B\")'id='button_b'class='farm_icon farm_icon_b'></a></td><td><a href='#'onclick='return setKeyEditMode(\"C\")'id='button_c'class='farm_icon farm_icon_c'></a></td><td><a href='#'onclick='return setKeyEditMode(\"Master\")'id='button_master'class='farm_icon farm_icon_m'></a></td></tr><tr class='hotkey_values'><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_a'value='A'></td><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_b'value='B'></td><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_c'value='C'></td><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_master'value='M'></td></tr><tr class='hotkey_values'><td colspan='2'><input class='btn tooltip'onclick='return setKeyEditMode(\"Skip\")'type='button'value='Skip'style='margin:0px 0px 0px 0px'title='Skip next farm'></td><td><input class='btn tooltip'onclick='return setKeyEditMode(\"Left\")'type='button'value='⇚'style='margin:0px 0px 0px 0px'title='Previous village'></td><td><input class='btn tooltip'type='button'onclick='return setKeyEditMode(\"Right\")'value='⇛'style='margin:0px 0px 0px 0px'title='Next village'></td></tr><tr class='hotkey_values'><td colspan='2'><input type='text'class='hotkey_value' READONLY id='hotkey_value_skip'value='S'></td><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_left'value='&#8592;'></td><td><input type='text'class='hotkey_value' READONLY id='hotkey_value_right'value='&#8594;'></td></tr></table></td><td><input type='checkbox' id='priority_one_enabled'/></td><td colspan='3'>If row matches <select id='priority_one_profile'></select> click <select id='priority_one_button'><option val='Skip'>Skip</option><option val='A'>A</option><option val='B'>B</option><option val='C'>C</option></select></td></tr><tr><td><input type='checkbox' id='priority_two_enabled'/></td><td colspan='3'>If row matches <select id='priority_two_profile'></select> click <select id='priority_two_button'><option val='Skip'>Skip</option><option val='A'>A</option><option val='B'>B</option><option val='C'>C</option></select></td></tr><tr><td><input type='checkbox' id='priority_three_enabled'/></td><td colspan='3'>If row matches <select id='priority_three_profile'></select> click <select id='priority_three_button'><option val='Skip'>Skip</option><option val='A'>A</option><option val='B'>B</option><option val='C'>C</option></select></td></tr><tr><td colspan='4'>If row doesn't match any profiles, click <select id='default_button'><option val='Skip'>Skip</option><option val='A'>A</option><option val='B'>B</option><option val='C'>C</option></select></td></tr></tbody></table></div>")),formatSettings()}function formatSettings(){var a=$("#enable_help");a.attr("title","Filters left unchecked will not be applied"),UI.ToolTip(a);var b=$("#continent_help");b.attr("title","Separate continents with a period. Example: 55.54.53"),UI.ToolTip(b),loadDefaultProfile(),fillProfileList(),getSettingInputs(),fillSettingInputs(),fillMasterSettings(),scriptSettings=settings({name:"settings"}).first().settings,$(".settingsTable tr:gt(0):lt(9) > td:not(:first-child) input,.settingsTable tr:gt(0):lt(9) > td:not(:first-child) select").change(function(){var a=$("#settingsProfile option:selected").text(),b=getFilterInputs();profiles({name:a}).update({settings:b})}),$(".settingsTable tr:gt(11) > td > input:not(:input[type=submit],:input[type=button]),.settingsTable tr:gt(11) > td > select,.settingsTable tr:gt(0):lt(10) > td:first-child > input,.settingsTable tr:gt(0):lt(10) > td:first-child > select").change(function(){var a=getSettingInputs();settings({name:"settings"}).update({settings:a}),scriptSettings=settings({name:"settings"}).first().settings})}function uglyHider(a){var b;b=$("#settingsBody").length>0?2:1,"+"===$(a).text()?$(a).text("-"):$(a).text("+"),0==parseInt($(a).attr("num"))?$("#contentContainer").find('div[class="vis"]').eq(b).children().eq(1).toggle():1==parseInt($(a).attr("num"))?$("#plunder_list_filters").toggle():2==parseInt($(a).attr("num"))&&$("#settingsBody").toggle()}function getUrlParameter(a,b){for(var c=a.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==b)return e[1]}}function getFilterInputs(){var a={blue:$(".settingsTable #blue").prop("checked"),green:$(".settingsTable #green").prop("checked"),yellow:$(".settingsTable #yellow").prop("checked"),red_yellow:$(".settingsTable #red_yellow").prop("checked"),red_blue:$(".settingsTable #red_blue").prop("checked"),red:$(".settingsTable #red").prop("checked"),enable_loot:$(".settingsTable #enable_loot").prop("checked"),full:$(".settingsTable #full").prop("checked"),partial:$(".settingsTable #partial").prop("checked"),none:$(".settingsTable #none").prop("checked"),enable_attacks:$(".settingsTable #enable_attacks").prop("checked"),attack_operator:$(".settingsTable #attack_operator").val(),attack_value:$(".settingsTable #attack_value").val(),enable_walls:$(".settingsTable #enable_walls").prop("checked"),wall_operator:$(".settingsTable #wall_operator").val(),wall_value:$(".settingsTable #wall_value").val(),enable_distances:$(".settingsTable #enable_distances").prop("checked"),distance_operator:$(".settingsTable #distance_operator").val(),distance_value:$(".settingsTable #distance_value").val(),enable_continents:$(".settingsTable #enable_continents").prop("checked"),continent_display:$(".settingsTable #continent_display").val(),continent_value:$(".settingsTable #continent_value").val(),enable_resources:$(".settingsTable #enable_resources").prop("checked"),resource_operator:$(".settingsTable #resource_operator").val(),resources_value:$(".settingsTable #resources_value").val(),enable_attack_time:$(".settingsTable #enable_attack_time").prop("checked"),attack_time_display:$(".settingsTable #attack_time_display").val(),attack_time_value:$(".settingsTable #attack_time_value").val(),enable_sent_time:$(".settingsTable #enable_sent_time").prop("checked"),sent_time_display:$(".settingsTable #sent_time_display").val(),sent_time_value:$(".settingsTable #sent_time_value").val()};return a}function getSettingInputs(){var a={start_page:$(".settingsTable #start_page").val(),end_page:$(".settingsTable #end_page").val(),sort_first_by:$(".settingsTable #sort_first_by").val(),sort_second_by:$(".settingsTable #sort_second_by").val(),apply_auto:$(".settingsTable #apply_auto").prop("checked"),show_buildings:$(".settingsTable #show_buildings").prop("checked"),next_village_no_farms:$(".settingsTable #next_village_no_farms").prop("checked"),next_village_units:$(".settingsTable #next_village_units").prop("checked"),scouts_left:$(".settingsTable #scouts_left").val(),farming_troops_left:$(".settingsTable #farming_troops_left").val(),hotkey_value_a:$(".settingsTable #hotkey_value_a").val(),hotkey_code_a:keycodes.a,hotkey_value_b:$(".settingsTable #hotkey_value_b").val(),hotkey_code_b:keycodes.b,hotkey_value_c:$(".settingsTable #hotkey_value_c").val(),hotkey_code_c:keycodes.c,hotkey_value_master:$(".settingsTable #hotkey_value_master").val(),hotkey_code_master:keycodes.master,hotkey_value_skip:$(".settingsTable #hotkey_value_skip").val(),hotkey_code_skip:keycodes.skip,hotkey_value_left:$(".settingsTable #hotkey_value_left").val(),hotkey_code_left:keycodes.left,hotkey_value_right:$(".settingsTable #hotkey_value_right").val(),hotkey_code_right:keycodes.right,priority_one_enabled:$(".settingsTable #priority_one_enabled").prop("checked"),priority_one_profile:$(".settingsTable #priority_one_profile").val(),priority_one_button:$(".settingsTable #priority_one_button").val(),priority_two_enabled:$(".settingsTable #priority_two_enabled").prop("checked"),priority_two_profile:$(".settingsTable #priority_two_profile").val(),priority_two_button:$(".settingsTable #priority_two_button").val(),priority_three_enabled:$(".settingsTable #priority_three_enabled").prop("checked"),priority_three_profile:$(".settingsTable #priority_three_profile").val(),priority_three_button:$(".settingsTable #priority_three_button").val(),default_button:$(".settingsTable #default_button").val()};return 0==settings().first()&&(settings.insert({name:"settings",settings:a}),scriptSettings=settings({name:"settings"}).first().settings),a}function fillSettingInputs(){var a=settings({name:"settings"}).first().settings;$(".settingsTable #start_page").val(a.start_page),$(".settingsTable #end_page").val(a.end_page),$(".settingsTable #sort_first_by").val(a.sort_first_by),$(".settingsTable #sort_second_by").val(a.sort_second_by),$(".settingsTable #apply_auto").prop("checked",a.apply_auto),$(".settingsTable #show_buildings").prop("checked",a.show_buildings),$(".settingsTable #next_village_no_farms").prop("checked",a.next_village_no_farms),$(".settingsTable #next_village_units").prop("checked",a.next_village_units),$(".settingsTable #scouts_left").val(a.scouts_left),$(".settingsTable #farming_troops_left").val(a.farming_troops_left),$(".settingsTable #hotkey_value_a").val(a.hotkey_value_a),$(".settingsTable #hotkey_value_b").val(a.hotkey_value_b),$(".settingsTable #hotkey_value_c").val(a.hotkey_value_c),$(".settingsTable #hotkey_value_master").val(a.hotkey_value_master),$(".settingsTable #hotkey_value_skip").val(a.hotkey_value_skip),$(".settingsTable #hotkey_value_left").val(a.hotkey_value_left),$(".settingsTable #hotkey_value_right").val(a.hotkey_value_right),$(".settingsTable #priority_one_enabled").prop("checked",a.priority_one_enabled),$(".settingsTable #priority_one_profile").val(a.priority_one_profile),$(".settingsTable #priority_one_button").val(a.priority_one_button),$(".settingsTable #priority_two_enabled").prop("checked",a.priority_two_enabled),$(".settingsTable #priority_two_profile").val(a.priority_two_profile),$(".settingsTable #priority_two_button").val(a.priority_two_button),$(".settingsTable #priority_three_enabled").prop("checked",a.priority_three_enabled),$(".settingsTable #priority_three_profile").val(a.priority_three_profile),$(".settingsTable #priority_three_button").val(a.priority_three_button),$(".settingsTable #default_button").val(a.default_button)}function loadDefaultProfile(){0==profiles({name:"Default"}).first()&&profiles.insert({name:"Default",settings:{blue:!1,green:!1,yellow:!1,red_yellow:!1,red_blue:!1,red:!1,enable_loot:!1,full:!1,partial:!1,none:!1,enable_attacks:!1,attack_operator:"greater_than",attack_value:"",enable_walls:!1,wall_operator:"greater_than",wall_value:"",enable_distances:!1,distance_operator:"greater_than",distance_value:"",enable_continents:!1,continent_display:"hide",continent_value:"",enable_resources:!1,resource_operator:"greater_than",resources_value:"",enable_attack_time:!1,attack_time_display:"hide",attack_time_value:"",enable_sent_time:!1,sent_time_display:"hide",sent_time_value:""}}),loadProfile("Default")}function setDefaultProfile(){var a=$("#settingsProfile").val(),b=profiles({name:a}).first().settings;profiles({name:"Default"}).update({settings:b}),loadProfile("Default"),$("#settingsProfile").val("Default")}function deleteProfile(){var a=$("#settingsProfile").val();profiles({name:a}).remove(),loadProfile("Default"),$("#settingsProfile option[value='"+a+"']").remove(),$("#settingsProfile").val("Default"),$("#priority_one_profile option[value='"+a+"']").remove(),$("#priority_two_profile option[value='"+a+"']").remove(),$("#priority_three_profile option[value='"+a+"']").remove(),$("#priority_one_profile").val("Default"),$("#priority_two_profile").val("Default"),$("#priority_three_profile").val("Default")}function loadProfile(a){var b=profiles({name:a}).first().settings;$(".settingsTable #blue").prop("checked",b.blue),$(".settingsTable #green").prop("checked",b.green),$(".settingsTable #yellow").prop("checked",b.yellow),$(".settingsTable #red_yellow").prop("checked",b.red_yellow),$(".settingsTable #red_blue").prop("checked",b.red_blue),$(".settingsTable #red").prop("checked",b.red),$(".settingsTable #enable_loot").prop("checked",b.enable_loot),$(".settingsTable #full").prop("checked",b.full),$(".settingsTable #partial").prop("checked",b.partial),$(".settingsTable #none").prop("checked",b.none),$(".settingsTable #enable_attacks").prop("checked",b.enable_attacks),$(".settingsTable #attack_operator").val(b.attack_operator),$(".settingsTable #attack_value").val(b.attack_value),
$(".settingsTable #enable_walls").prop("checked",b.enable_walls),$(".settingsTable #wall_operator").val(b.wall_operator),$(".settingsTable #wall_value").val(b.wall_value),$(".settingsTable #enable_distances").prop("checked",b.enable_distances),$(".settingsTable #distance_operator").val(b.distance_operator),$(".settingsTable #distance_value").val(b.distance_value),$(".settingsTable #enable_continents").prop("checked",b.enable_continents),$(".settingsTable #continent_display").val(b.continent_display),$(".settingsTable #continent_value").val(b.continent_value),$(".settingsTable #enable_resources").prop("checked",b.enable_resources),$(".settingsTable #resource_operator").val(b.resource_operator),$(".settingsTable #resources_value").val(b.resources_value),$(".settingsTable #enable_attack_time").prop("checked",b.enable_attack_time),$(".settingsTable #attack_time_display").val(b.attack_time_display),$(".settingsTable #attack_time_value").val(b.attack_time_value),$(".settingsTable #enable_sent_time").prop("checked",b.enable_sent_time),$(".settingsTable #sent_time_display").val(b.sent_time_display),$(".settingsTable #sent_time_value").val(b.sent_time_value),$("#settingsProfile").val(a)}function fillProfileList(){profiles().each(function(a,b){$("#settingsProfile").append("<option value='"+a.name+"'>"+a.name+"</option>")}),$("#settingsProfile").val("Default")}function createProfile(a){Dialog.close(),0==profiles({name:a}).first()?(profiles.insert({name:a,settings:{blue:!1,green:!1,yellow:!1,red_yellow:!1,red_blue:!1,red:!1,enable_loot:!1,full:!1,partial:!1,none:!1,enable_attacks:!1,attack_operator:"greater_than",attack_value:"",enable_walls:!1,wall_operator:"greater_than",wall_value:"",enable_distances:!1,distance_operator:"greater_than",distance_value:"",enable_continents:!1,continent_display:"hide",continent_value:"",enable_resources:!1,resource_operator:"greater_than",resources_value:"",enable_attack_time:!1,attack_time_display:"hide",attack_time_value:"",enable_sent_time:!1,sent_time_display:"hide",sent_time_value:""}}),$("#settingsProfile").append("<option value='"+a+"'>"+a+"</option>"),$("#priority_one_profile").append("<option value='"+a+"'>"+a+"</option>"),$("#priority_two_profile").append("<option value='"+a+"'>"+a+"</option>"),$("#priority_three_profile").append("<option value='"+a+"'>"+a+"</option>"),$("#settingsProfile").val(a),loadProfile(a)):UI.ErrorMessage("A profile with that name already exists.")}function hotkeysOnOff(){$("input:not(:input[type=submit])").focusin(function(){window.onkeydown=function(){}}),$("input:not(:input[type=submit])").focusout(function(){turnOnHotkeys()})}function turnOnHotkeys(){window.onkeydown=function(a){if(editingKey)editKey(a);else if(!typing){var b=$("#plunder_list tr").filter(":visible").eq(1),c=b.children("td").eq(9).children("a"),d=b.children("td").eq(10).children("a"),e=b.children("td").eq(11).children("a");switch(a.which){case keycodes.a:tryClick(c);break;case keycodes.b:tryClick(d);break;case keycodes.c:tryClick(e);break;case keycodes.skip:b.hide();break;case keycodes.master:cansend&&filtersApplied&&selectMasterButton(b);break;case keycodes.left:getNewVillage("p");break;case keycodes.right:getNewVillage("n");break;default:return}}a.preventDefault()}}function tryClick(a){cansend&&filtersApplied&&(checkIfNextVillage()||(a.hasClass("farm_icon_disabled")||void 0==a.html()?(UI.ErrorMessage("That button is not selectable. Skipping row...",500),a.closest("tr").hide()):(a.click(),doTime(userset[s.next_village_scouts]||userset[s.next_village_farming_troops]?400:201))))}function doTime(a){cansend=!1,setTimeout(function(){cansend=!0},a)}function editKey(a){if(a.keyCode<=37&&a.keyCode>=40||a.keyCode<=48&&a.keyCode>=90)UI.ErrorMessage("You can only enter letters, numbers, or arrows. Plese try another key.",1500);else{var b=String.fromCharCode(a.keyCode);switch(37==a.keyCode&&(b="←"),38==a.keyCode&&(b="↑"),39==a.keyCode&&(b="→"),40==a.keyCode&&(b="↓"),keyToEdit){case"A":keycodes.a=a.keyCode,$("#hotkey_value_a").val(b);break;case"B":keycodes.b=a.keyCode,$("#hotkey_value_b").val(b);break;case"C":keycodes.c=a.keyCode,$("#hotkey_value_c").val(b);break;case"Master":keycodes.master=a.keyCode,$("#hotkey_value_master").val(b);break;case"Skip":keycodes.skip=a.keyCode,$("#hotkey_value_skip").val(b);break;case"Left":keycodes.left=a.keyCode,$("#hotkey_value_left").val(b);break;case"Right":keycodes.right=a.keyCode,$("#hotkey_value_right").val(b);break;default:return}UI.SuccessMessage(b+" is now mapped to the "+keyToEdit+" button."),updateKeypressSettings(),editingKey=!1}}function updateKeypressSettings(){var a=settings().first().settings;a.hotkey_value_a=$("#hotkey_value_a").val(),a.hotkey_code_a=keycodes.a,a.hotkey_value_b=$("#hotkey_value_b").val(),a.hotkey_code_b=keycodes.b,a.hotkey_value_c=$("#hotkey_value_c").val(),a.hotkey_code_c=keycodes.c,a.hotkey_value_master=$("#hotkey_value_master").val(),a.hotkey_code_master=keycodes.master,a.hotkey_value_skip=$("#hotkey_value_skip").val(),a.hotkey_code_skip=keycodes.skip,a.hotkey_value_left=$("#hotkey_value_left").val(),a.hotkey_code_left=keycodes.left,a.hotkey_value_right=$("#hotkey_value_right").val(),a.hotkey_code_right=keycodes.right,a.priority_one_enabled=$("#priorityOneEnabled").prop("checked"),a.priority_one_profile=$("#priorityOneProfile").val(),a.priority_one_button=$("#priorityOneButton").val(),a.priority_two_enabled=$("#priorityTwoEnabled").prop("checked"),a.priority_two_profile=$("#priorityTwoProfile").val(),a.priority_two_button=$("#priorityTwoButton").val(),a.priority_three_enabled=$("#priorityThreeEnabled").prop("checked"),a.priority_three_profile=$("#priorityThreeProfile").val(),a.priority_three_button=$("#priorityThreeButton").val(),a.default_button=$("#defaultButton").val(),settings({name:"settings"}).update({settings:a})}function fillKeypressSettings(){null==$.jStorage.get("keyPressSettings")&&$.jStorage.set("keyPressSettings",keyPressSettings),keyPressSettings=$.jStorage.get("keyPressSettings"),keycodes.a=keyPressSettings.a_code,$("#hotkey_value_a").val(keyPressSettings.a_char),keycodes.b=keyPressSettings.b_code,$("#hotkey_value_b").val(keyPressSettings.b_char),keycodes.c=keyPressSettings.c_code,$("#hotkey_value_c").val(keyPressSettings.c_char),keycodes.master=keyPressSettings.master_code,$("#hotkey_value_master").val(keyPressSettings.master_char),keycodes.skip=keyPressSettings.skip_code,$("#hotkey_value_skip").val(keyPressSettings.skip_char),keycodes.left=keyPressSettings.left_code,$("#hotkey_value_left").val(keyPressSettings.left_char),keycodes.right=keyPressSettings.right_code,$("#hotkey_value_right").val(keyPressSettings.right_char),$("#priorityOneEnabled").prop("checked",keyPressSettings.priorityOneEnabled),$("#priorityOneProfile").val(keyPressSettings.priorityOneProfile),$("#priorityOneButton").val(keyPressSettings.priorityOneButton),$("#priorityTwoEnabled").prop("checked",keyPressSettings.priorityTwoEnabled),$("#priorityTwoProfile").val(keyPressSettings.priorityTwoProfile),$("#priorityTwoButton").val(keyPressSettings.priorityTwoButton),$("#priorityThreeEnabled").prop("checked",keyPressSettings.priorityThreeEnabled),$("#priorityThreeProfile").val(keyPressSettings.priorityThreeProfile),$("#priorityThreeButton").val(keyPressSettings.priorityThreeButton),$("#defaultButton").val(keyPressSettings.defaultButton)}function setKeyEditMode(a){return editingKey=!0,keyToEdit=a,UI.InfoMessage("Press any number, letter, or arrow key to set the hotkey for the <span style='font-weight:bold;'>"+a+"</span> button",1500),!1}function fillMasterSettings(){profiles().each(function(a,b){$("#priority_one_profile").append("<option value='"+a.name+"'>"+a.name+"</option>"),$("#priority_two_profile").append("<option value='"+a.name+"'>"+a.name+"</option>"),$("#priority_three_profile").append("<option value='"+a.name+"'>"+a.name+"</option>")})}function selectMasterButton(a){var b,c=$.jStorage.get("profile:"+keyPressSettings.priorityOneProfile),d=$.jStorage.get("profile:"+keyPressSettings.priorityTwoProfile),e=$.jStorage.get("profile:"+keyPressSettings.priorityThreeProfile),f=a.children("td").eq(9).children("a"),g=a.children("td").eq(10).children("a"),h=a.children("td").eq(11).children("a");switch(b=keyPressSettings.defaultButton,keyPressSettings.priorityThreeEnabled&&!checkRowToHide(a,e)&&(b=keyPressSettings.priorityThreeButton),keyPressSettings.priorityTwoEnabled&&!checkRowToHide(a,d)&&(b=keyPressSettings.priorityTwoButton),keyPressSettings.priorityOneEnabled&&!checkRowToHide(a,c)&&(b=keyPressSettings.priorityOneButton),b){case"A":tryClick(f);break;case"B":tryClick(g);break;case"C":tryClick(h);break;default:a.hide()}}function newProfileDialog(){Dialog.show("test","<div style='text-align:center;'><label>Profile Name</label><br /><input type='text' id='profileName'><br /><button class='btn btn-default btn-confirm-yes' style='margin: 10px 0 3px' onclick='createProfile($(\"#profileName\").val())'>Create Profile</button></div>"),hotkeysOnOff()}function checkRowToHide(a){}var TAFFY,exports,T;!function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(!TAFFY)for(e="2.7",f=1,g="000000",h=1e3,i={},j=function(a){return TAFFY.isArray(a)||TAFFY.isObject(a)?a:JSON.parse(a)},s=function(a,b){return t(a,function(a){return b.indexOf(a)>=0})},t=function(a,b,c){var d=[];return null==a?d:Array.prototype.filter&&a.filter===Array.prototype.filter?a.filter(b,c):(k(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},w=function(a){return"[object RegExp]"===Object.prototype.toString.call(a)},v=function(a){var b=T.isArray(a)?[]:T.isObject(a)?{}:null;if(null===a)return a;for(var c in a)b[c]=w(a[c])?a[c].toString():T.isArray(a[c])||T.isObject(a[c])?v(a[c]):a[c];return b},u=function(a){var b=JSON.stringify(a);return null===b.match(/regex/)?b:JSON.stringify(v(a))},k=function(a,b,c){var d,e,f,g;if(a&&(T.isArray(a)&&1===a.length||!T.isArray(a)))b(T.isArray(a)?a[0]:a,0);else for(f=0,a=T.isArray(a)?a:[a],g=a.length;g>f&&(e=a[f],T.isUndefined(e)&&!c||(d=b(e,f),d!==T.EXIT));f++);},l=function(a,b){var c,d,e=0;for(d in a)if(a.hasOwnProperty(d)&&(c=b(a[d],d,e++),c===T.EXIT))break},i.extend=function(a,b){i[a]=function(){return b.apply(this,arguments)}},m=function(a){var b;return T.isString(a)&&/[t][0-9]*[r][0-9]*/i.test(a)?!0:T.isObject(a)&&a.___id&&a.___s?!0:T.isArray(a)?(b=!0,k(a,function(a){return m(a)?void 0:(b=!1,TAFFY.EXIT)}),b):!1},o=function(a,b){var c=!0;return k(b,function(b){switch(T.typeOf(b)){case"function":if(!b.apply(a))return c=!1,TAFFY.EXIT;break;case"array":c=1===b.length?o(a,b[0]):2===b.length?o(a,b[0])||o(a,b[1]):3===b.length?o(a,b[0])||o(a,b[1])||o(a,b[2]):4===b.length?o(a,b[0])||o(a,b[1])||o(a,b[2])||o(a,b[3]):!1,b.length>4&&k(b,function(b){o(a,b)&&(c=!0)})}}),c},n=function(a){var b=[];return T.isString(a)&&/[t][0-9]*[r][0-9]*/i.test(a)&&(a={___id:a}),T.isArray(a)?(k(a,function(a){b.push(n(a))}),a=function(){var a=this,c=!1;return k(b,function(b){o(a,b)&&(c=!0)}),c}):T.isObject(a)?(T.isObject(a)&&a.___id&&a.___s&&(a={___id:a.___id}),l(a,function(a,c){T.isObject(a)||(a={is:a}),l(a,function(a,d){var e,f=[];e="hasAll"===d?function(a,b){b(a)}:k,e(a,function(a){var b,e=!0;b=function(){var b,f=this[c],g="==",h="!=",i="===",j="<",k=">",l="<=",m=">=",n="!==";return"undefined"==typeof f?!1:(0===d.indexOf("!")&&d!==h&&d!==n&&(e=!1,d=d.substring(1,d.length)),b="regex"===d?a.test(f):"lt"===d||d===j?a>f:"gt"===d||d===k?f>a:"lte"===d||d===l?a>=f:"gte"===d||d===m?f>=a:"left"===d?0===f.indexOf(a):"leftnocase"===d?0===f.toLowerCase().indexOf(a.toLowerCase()):"right"===d?f.substring(f.length-a.length)===a:"rightnocase"===d?f.toLowerCase().substring(f.length-a.length)===a.toLowerCase():"like"===d?f.indexOf(a)>=0:"likenocase"===d?f.toLowerCase().indexOf(a.toLowerCase())>=0:d===i||"is"===d?f===a:d===g?f==a:d===n?f!==a:d===h?f!=a:"isnocase"===d?f.toLowerCase?f.toLowerCase()===a.toLowerCase():f===a:"has"===d?T.has(f,a):"hasall"===d?T.hasAll(f,a):"contains"===d?TAFFY.isArray(f)&&f.indexOf(a)>-1:-1!==d.indexOf("is")||TAFFY.isNull(f)||TAFFY.isUndefined(f)||TAFFY.isObject(a)||TAFFY.isArray(a)?T[d]&&T.isFunction(T[d])&&0===d.indexOf("is")?T[d](f)===a:T[d]&&T.isFunction(T[d])?T[d](f,a):!1:a===f[d],b=b&&!e?!1:b||e?b:!0)},f.push(b)}),1===f.length?b.push(f[0]):b.push(function(){var a=this,b=!1;return k(f,function(c){c.apply(a)&&(b=!0)}),b})})}),a=function(){var a=this,c=!0;return c=(1!==b.length||b[0].apply(a))&&(2!==b.length||b[0].apply(a)&&b[1].apply(a))&&(3!==b.length||b[0].apply(a)&&b[1].apply(a)&&b[2].apply(a))&&(4!==b.length||b[0].apply(a)&&b[1].apply(a)&&b[2].apply(a)&&b[3].apply(a))?!0:!1,b.length>4&&k(b,function(b){o(a,b)||(c=!1)}),c}):T.isFunction(a)?a:void 0},q=function(a,b){var c=function(a,c){var d=0;return T.each(b,function(b){var e,f,g,h,i;if(e=b.split(" "),f=e[0],g=1===e.length?"logical":e[1],"logical"===g)h=p(a[f]),i=p(c[f]),T.each(h.length<=i.length?h:i,function(a,b){return h[b]<i[b]?(d=-1,TAFFY.EXIT):h[b]>i[b]?(d=1,TAFFY.EXIT):void 0});else if("logicaldesc"===g)h=p(a[f]),i=p(c[f]),T.each(h.length<=i.length?h:i,function(a,b){return h[b]>i[b]?(d=-1,TAFFY.EXIT):h[b]<i[b]?(d=1,TAFFY.EXIT):void 0});else{if("asec"===g&&a[f]<c[f])return d=-1,T.EXIT;if("asec"===g&&a[f]>c[f])return d=1,T.EXIT;if("desc"===g&&a[f]>c[f])return d=-1,T.EXIT;if("desc"===g&&a[f]<c[f])return d=1,T.EXIT}return 0===d&&"logical"===g&&h.length<i.length?d=-1:0===d&&"logical"===g&&h.length>i.length?d=1:0===d&&"logicaldesc"===g&&h.length>i.length?d=-1:0===d&&"logicaldesc"===g&&h.length<i.length&&(d=1),0!==d?T.EXIT:void 0}),d};return a&&a.push?a.sort(c):a},function(){var a={},b=0;p=function(c){return b>h&&(a={},b=0),a["_"+c]||function(){var d,e,f,g=String(c),h=[],i="_",j="";for(d=0,e=g.length;e>d;d++)f=g.charCodeAt(d),f>=48&&57>=f||46===f?("n"!==j&&(j="n",h.push(i.toLowerCase()),i=""),i+=g.charAt(d)):("s"!==j&&(j="s",h.push(parseFloat(i)),i=""),i+=g.charAt(d));return h.push("n"===j?parseFloat(i):i.toLowerCase()),h.shift(),a["_"+c]=h,b++,h}()}}(),r=function(){this.context({results:this.getDBI().query(this.context())})},i.extend("filter",function(){var a=TAFFY.mergeObj(this.context(),{run:null}),b=[];return k(a.q,function(a){b.push(a)}),a.q=b,k(arguments,function(b){a.q.push(n(b)),a.filterRaw.push(b)}),this.getroot(a)}),i.extend("order",function(a){a=a.split(",");var b,c=[];return k(a,function(a){c.push(a.replace(/^\s*/,"").replace(/\s*$/,""))}),b=TAFFY.mergeObj(this.context(),{sort:null}),b.order=c,this.getroot(b)}),i.extend("limit",function(a){var b,c=TAFFY.mergeObj(this.context(),{});return c.limit=a,c.run&&c.sort&&(b=[],k(c.results,function(c,d){return d+1>a?TAFFY.EXIT:void b.push(c)}),c.results=b),this.getroot(c)}),i.extend("start",function(a){var b,c=TAFFY.mergeObj(this.context(),{});return c.start=a,c.run&&c.sort&&!c.limit?(b=[],k(c.results,function(c,d){d+1>a&&b.push(c)}),c.results=b):c=TAFFY.mergeObj(this.context(),{run:null,start:a}),this.getroot(c)}),i.extend("update",function(a,b,c){var d,e=!0,f={},g=arguments;return!TAFFY.isString(a)||2!==arguments.length&&3!==arguments.length?(f=a,2===g.length&&(e=b)):(f[a]=b,3===arguments.length&&(e=c)),d=this,r.call(this),k(this.context().results,function(a){var b=f;TAFFY.isFunction(b)?b=b.apply(TAFFY.mergeObj(a,{})):T.isFunction(b)&&(b=b(TAFFY.mergeObj(a,{}))),TAFFY.isObject(b)&&d.getDBI().update(a.___id,b,e)}),this.context().results.length&&this.context({run:null}),this}),i.extend("remove",function(a){var b=this,c=0;return r.call(this),k(this.context().results,function(a){b.getDBI().remove(a.___id),c++}),this.context().results.length&&(this.context({run:null}),b.getDBI().removeCommit(a)),c}),i.extend("count",function(){return r.call(this),this.context().results.length}),i.extend("callback",function(a,b){if(a){var c=this;setTimeout(function(){r.call(c),a.call(c.getroot(c.context()))},b||0)}return null}),i.extend("get",function(){return r.call(this),this.context().results}),i.extend("stringify",function(){return JSON.stringify(this.get())}),i.extend("first",function(){return r.call(this),this.context().results[0]||!1}),i.extend("last",function(){return r.call(this),this.context().results[this.context().results.length-1]||!1}),i.extend("sum",function(){var a=0,b=this;return r.call(b),k(arguments,function(c){k(b.context().results,function(b){a+=b[c]||0})}),a}),i.extend("min",function(a){var b=null;return r.call(this),k(this.context().results,function(c){(null===b||c[a]<b)&&(b=c[a])}),b}),function(){var a=function(){var a,b,c;return a=function(a,b,c){var d,e,f;switch(2===c.length?(d=a[c[0]],f="===",e=b[c[1]]):(d=a[c[0]],f=c[1],e=b[c[2]]),f){case"===":return d===e;case"!==":return d!==e;case"<":return e>d;case">":return d>e;case"<=":return e>=d;case">=":return d>=e;case"==":return d==e;case"!=":return d!=e;default:throw String(f)+" is not supported"}},b=function(a,b){var c,d,e={};for(c in a)a.hasOwnProperty(c)&&(e[c]=a[c]);for(c in b)b.hasOwnProperty(c)&&"___id"!==c&&"___s"!==c&&(d=TAFFY.isUndefined(e[c])?"":"right_",e[d+String(c)]=b[c]);return e},c=function(c){var d,e,f=arguments,g=f.length,h=[];if("function"!=typeof c.filter){if(!c.TAFFY)throw"TAFFY DB or result not supplied";d=c()}else d=c;return this.context({results:this.getDBI().query(this.context())}),TAFFY.each(this.context().results,function(c){d.each(function(d){var i,j=!0;a:for(e=1;g>e&&(i=f[e],j="function"==typeof i?i(c,d):"object"==typeof i&&i.length?a(c,d,i):!1,j);e++);j&&h.push(b(c,d))})}),TAFFY(h)()}}();i.extend("join",a)}(),i.extend("max",function(a){var b=null;return r.call(this),k(this.context().results,function(c){(null===b||c[a]>b)&&(b=c[a])}),b}),i.extend("select",function(){var a=[],b=arguments;return r.call(this),1===arguments.length?k(this.context().results,function(c){a.push(c[b[0]])}):k(this.context().results,function(c){var d=[];k(b,function(a){d.push(c[a])}),a.push(d)}),a}),i.extend("distinct",function(){var a=[],b=arguments;return r.call(this),1===arguments.length?k(this.context().results,function(c){var d=c[b[0]],e=!1;k(a,function(a){return d===a?(e=!0,TAFFY.EXIT):void 0}),e||a.push(d)}):k(this.context().results,function(c){var d=[],e=!1;k(b,function(a){d.push(c[a])}),k(a,function(a){var c=!0;return k(b,function(b,e){return d[e]!==a[e]?(c=!1,TAFFY.EXIT):void 0}),c?(e=!0,TAFFY.EXIT):void 0}),e||a.push(d)}),a}),i.extend("supplant",function(a,b){var c=[];return r.call(this),k(this.context().results,function(b){c.push(a.replace(/\{([^\{\}]*)\}/g,function(a,c){var d=b[c];return"string"==typeof d||"number"==typeof d?d:a}))}),b?c:c.join("")}),i.extend("each",function(a){return r.call(this),k(this.context().results,a),this}),i.extend("map",function(a){var b=[];return r.call(this),k(this.context().results,function(c){b.push(a(c))}),b}),T=function(a){var b,c,d,e=[],h={},p=1,r={template:!1,onInsert:!1,onUpdate:!1,onRemove:!1,onDBChange:!1,storageName:!1,forcePropertyCase:null,cacheSize:100,name:""},s=new Date,t=0,v=0,w={};return c=function(a){var b=[],d=!1;return 0===a.length?e:(k(a,function(a){T.isString(a)&&/[t][0-9]*[r][0-9]*/i.test(a)&&e[h[a]]&&(b.push(e[h[a]]),d=!0),T.isObject(a)&&a.___id&&a.___s&&e[h[a.___id]]&&(b.push(e[h[a.___id]]),d=!0),T.isArray(a)&&k(a,function(a){k(c(a),function(a){b.push(a)})})}),d&&b.length>1&&(b=[]),b)},b={dm:function(a){return a&&(s=a,w={},t=0,v=0),r.onDBChange&&setTimeout(function(){r.onDBChange.call(e)},0),r.storageName&&setTimeout(function(){localStorage.setItem("taffy_"+r.storageName,JSON.stringify(e))}),s},insert:function(a,c){var i=[],m=[],n=j(a);return k(n,function(a,d){var j,n;return T.isArray(a)&&0===d?(k(a,function(a){i.push("lower"===r.forcePropertyCase?a.toLowerCase():"upper"===r.forcePropertyCase?a.toUpperCase():a)}),!0):(T.isArray(a)?(j={},k(a,function(a,b){j[i[b]]=a}),a=j):T.isObject(a)&&r.forcePropertyCase&&(n={},l(a,function(b,c){n["lower"===r.forcePropertyCase?c.toLowerCase():"upper"===r.forcePropertyCase?c.toUpperCase():c]=a[c]}),a=n),p++,a.___id="T"+String(g+f).slice(-6)+"R"+String(g+p).slice(-6),a.___s=!0,m.push(a.___id),r.template&&(a=T.mergeObj(r.template,a)),e.push(a),h[a.___id]=e.length-1,r.onInsert&&(c||TAFFY.isUndefined(c))&&r.onInsert.call(a),void b.dm(new Date))}),d(m)},sort:function(a){return e=q(e,a.split(",")),h={},k(e,function(a,b){h[a.___id]=b}),b.dm(new Date),!0},update:function(a,c,d){var f,g,i,j,k={};r.forcePropertyCase&&(l(c,function(a,b){k["lower"===r.forcePropertyCase?b.toLowerCase():"upper"===r.forcePropertyCase?b.toUpperCase():b]=a}),c=k),f=e[h[a]],g=T.mergeObj(f,c),i={},j=!1,l(g,function(a,b){(TAFFY.isUndefined(f[b])||f[b]!==a)&&(i[b]=a,j=!0)}),j&&(r.onUpdate&&(d||TAFFY.isUndefined(d))&&r.onUpdate.call(g,e[h[a]],i),e[h[a]]=g,b.dm(new Date))},remove:function(a){e[h[a]].___s=!1},removeCommit:function(a){var c;for(c=e.length-1;c>-1;c--)e[c].___s||(r.onRemove&&(a||TAFFY.isUndefined(a))&&r.onRemove.call(e[c]),h[e[c].___id]=void 0,e.splice(c,1));h={},k(e,function(a,b){h[a.___id]=b}),b.dm(new Date)},query:function(a){var d,f,g,h,i,j;if(r.cacheSize&&(f="",k(a.filterRaw,function(a){return T.isFunction(a)?(f="nocache",TAFFY.EXIT):void 0}),""===f&&(f=u(T.mergeObj(a,{q:!1,run:!1,sort:!1})))),!a.results||!a.run||a.run&&b.dm()>a.run){if(g=[],r.cacheSize&&w[f])return w[f].i=t++,w[f].results;0===a.q.length&&0===a.index.length?(k(e,function(a){g.push(a)}),d=g):(h=c(a.index),k(h,function(b){(0===a.q.length||o(b,a.q))&&g.push(b)}),d=g)}else d=a.results;return!(a.order.length>0)||a.run&&a.sort||(d=q(d,a.order)),d.length&&(a.limit&&a.limit<d.length||a.start)&&(i=[],k(d,function(b,c){if(!a.start||a.start&&c+1>=a.start)if(a.limit){if(j=a.start?c+1-a.start:c,j<a.limit)i.push(b);else if(j>a.limit)return TAFFY.EXIT}else i.push(b)}),d=i),r.cacheSize&&"nocache"!==f&&(v++,setTimeout(function(){var a,b;v>=2*r.cacheSize&&(v=0,a=t-r.cacheSize,b={},l(function(c,d){c.i>=a&&(b[d]=c)}),w=b)},0),w[f]={i:t++,results:d}),d}},d=function(){var a,c;return a=TAFFY.mergeObj(TAFFY.mergeObj(i,{insert:void 0}),{getDBI:function(){return b},getroot:function(a){return d.call(a)},context:function(a){return a&&(c=TAFFY.mergeObj(c,a.hasOwnProperty("results")?TAFFY.mergeObj(a,{run:new Date,sort:new Date}):a)),c},extend:void 0}),c=this&&this.q?this:{limit:!1,start:!1,q:[],filterRaw:[],index:[],order:[],results:!1,run:null,sort:null,settings:r},k(arguments,function(a){m(a)?c.index.push(a):c.q.push(n(a)),c.filterRaw.push(a)}),a},f++,a&&b.insert(a),d.insert=b.insert,d.merge=function(a,c,e){var f={},g=[],h={};return e=e||!1,c=c||"id",k(a,function(a){var h;f[c]=a[c],g.push(a[c]),h=d(f).first(),h?b.update(h.___id,a,e):b.insert(a,e)}),h[c]=g,d(h)},d.TAFFY=!0,d.sort=b.sort,d.settings=function(a){return a&&(r=TAFFY.mergeObj(r,a),a.template&&d().update(a.template)),r},d.store=function(a){var b,c=!1;return localStorage&&(a&&(b=localStorage.getItem("taffy_"+a),b&&b.length>0&&(d.insert(b),c=!0),e.length>0&&setTimeout(function(){localStorage.setItem("taffy_"+r.storageName,JSON.stringify(e))})),d.settings({storageName:a})),d},d},TAFFY=T,T.each=k,T.eachin=l,T.extend=i.extend,TAFFY.EXIT="TAFFYEXIT",TAFFY.mergeObj=function(a,b){var c={};return l(a,function(b,d){c[d]=a[d]}),l(b,function(a,d){c[d]=b[d]}),c},TAFFY.has=function(a,b){var c,d=!1;if(a.TAFFY)return d=a(b),d.length>0?!0:!1;switch(T.typeOf(a)){case"object":if(T.isObject(b))l(b,function(c,e){return d!==!0||T.isUndefined(a[e])||!a.hasOwnProperty(e)?(d=!1,TAFFY.EXIT):void(d=T.has(a[e],b[e]))});else if(T.isArray(b))k(b,function(c,e){return d=T.has(a,b[e]),d?TAFFY.EXIT:void 0});else if(T.isString(b))return TAFFY.isUndefined(a[b])?!1:!0;return d;case"array":if(T.isObject(b))k(a,function(c,e){return d=T.has(a[e],b),d===!0?TAFFY.EXIT:void 0});else if(T.isArray(b))k(b,function(c,e){return k(a,function(c,f){return d=T.has(a[f],b[e]),d===!0?TAFFY.EXIT:void 0}),d===!0?TAFFY.EXIT:void 0});else if(T.isString(b)||T.isNumber(b))for(d=!1,c=0;c<a.length;c++)if(d=T.has(a[c],b))return!0;return d;case"string":if(T.isString(b)&&b===a)return!0;break;default:if(T.typeOf(a)===T.typeOf(b)&&a===b)return!0}return!1},TAFFY.hasAll=function(a,b){var c,d=TAFFY;return d.isArray(b)?(c=!0,k(b,function(b){return c=d.has(a,b),c===!1?TAFFY.EXIT:void 0}),c):d.has(a,b)},TAFFY.typeOf=function(a){var b=typeof a;return"object"===b&&(a?"number"!=typeof a.length||a.propertyIsEnumerable("length")||(b="array"):b="null"),b},TAFFY.getObjectKeys=function(a){var b=[];return l(a,function(a,c){b.push(c)}),b.sort(),b},TAFFY.isSameArray=function(a,b){return TAFFY.isArray(a)&&TAFFY.isArray(b)&&a.join(",")===b.join(",")?!0:!1},TAFFY.isSameObject=function(a,b){var c=TAFFY,d=!0;return c.isObject(a)&&c.isObject(b)&&c.isSameArray(c.getObjectKeys(a),c.getObjectKeys(b))?l(a,function(e,f){return c.isObject(a[f])&&c.isObject(b[f])&&c.isSameObject(a[f],b[f])||c.isArray(a[f])&&c.isArray(b[f])&&c.isSameArray(a[f],b[f])||a[f]===b[f]?void 0:(d=!1,TAFFY.EXIT)}):d=!1,d},a=["String","Number","Object","Array","Boolean","Null","Function","Undefined"],b=function(a){return function(b){return TAFFY.typeOf(b)===a.toLowerCase()?!0:!1}},c=0;c<a.length;c++)d=a[c],TAFFY["is"+d]=b(d)}(),"object"==typeof exports&&(exports.taffy=TAFFY);var version="1.11",sitter="0"!=window.game_data.player.sitter?"t="+window.game_data.player.id+"&":"",link=["https://"+window.location.host+"/game.php?"+sitter+"village=","&screen=am_farm"],scriptURL="https://ntoombs19.github.io/LA-Enhancer/",currentGameTime=getCurrentGameTime(),reports,reportBuildings,villageAttacks,profiles,settings,lastAjaxCall="pages",getBuildings=!1,editingKey=!1,typing=!1,keyToEdit,scriptSettings,keycodes={a:65,b:66,c:67,skip:83,right:39,left:37,master:77};$.getScript(scriptURL+"js/resources2.js",function(){reportBuildings=TAFFY(),reportBuildings.store("reportBuildings"),villageAttacks=TAFFY(),villageAttacks.store("villageAttacks"),profiles=TAFFY(),profiles.store("profiles"),settings=TAFFY(),settings.store("settings"),checkPage()}),$(window).ajaxStop(function(){if(console.log("Ajax done"),"pages"==lastAjaxCall){var a="",b="";getBuildings&&(a="<th><a href=''><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/buildings/main.png?8720a'></a></th><th><a href=''><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/buildings/barracks.png?8720a'></a></th><th><a href=''><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/buildings/stable.png?8720a'></a></th><th><a href=''><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/buildings/garage.png?8720a'></a></th><th><a href=''><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/buildings/snob.png?8720a'></a></th><th><a href=''><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/buildings/smith.png?8720a'></a></th><th><a href=''><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/buildings/statue.png?8720a'></a></th><th><a href=''><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/buildings/market.png?8720a'></a></th><th><a href=''><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/buildings/wood.png?8720a'></a></th><th><a href=''><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/buildings/stone.png?8720a'></a></th><th><a href=''><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/buildings/iron.png?8720a'></a></th><th><a href=''><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/buildings/farm.png?8720a'></a></th><th><a href=''><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/buildings/storage.png?8720a'></a></th><th><a href=''><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/buildings/hide.png?8720a'></a></th>",b="<th><a href='#sort' class='desc' onclick='sortByColumn(\"points\", this)'>Points</a></th>"),$("#am_widget_Farm").append("<div class='body'><table id='plunder_list' style='width:100%;'><th></th><th></th><th>Village</th><th><a href='#sort' class='desc' onclick='sortByColumn(\"attacks\", this)'><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/command/attack.png?6d2c9'></a></th><th><a href='#sort' class='desc' onclick='sortByColumn(\"plunderTime\", this)'>Landed</a></th><th><a href='#sort' class='desc' onclick='sortByColumn(\"sentTime\", this)'>Sent</a></th><th><a href='#sort' class='desc' onclick='sortByColumn(\"wood\", this)'><span class='icon header wood' title='Wood'></span></a></th><th><a href='#sort' class='desc' onclick='sortByColumn(\"clay\", this)'><span class='icon header stone' title='Stone'></span></a></th><th><a href='#sort' class='desc' onclick='sortByColumn(\"iron\", this)'><span class='icon header iron' title='Iron'></span></a></th>"+a+"<th><a href='#sort' class='desc' onclick='sortByColumn(\"wall\", this)'><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/buildings/wall.png?8720a'></a></th>"+b+"<th><a href='#sort' class='desc' onclick='sortByColumn(\"distance\", this)'><img src='https://dsen.innogamescdn.com/8.31.1/24230/graphic/rechts.png?d8153'></a></th><th></th><th></th><th></th><th></th></table></div>"),createNewTable("distance","asc"),$("#am_widget_Farm").show()}return"sendUnits"==lastAjaxCall?!1:void 0}),$(document).off();